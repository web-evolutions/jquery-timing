/* ========================================================================
 * jquery-timing-v0.0.1 : Monday, 28.04.2014, 08:22:39
 * a Plugin for jQuery
 * Copyright 2014 Web-evolutions
 * ========================================================================
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU Affero General Public License as
 * published by the Free Software Foundation, either version 3 of the
 * License, or any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Affero General Public License for more details.
 * 
 * You should have received a copy of the GNU Affero General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 * ======================================================================== */

if("undefined"==typeof jQuery)throw new Error("Timing requires jQuery");!function(a,b){var c="timing",d="plugin_"+c,e={hours:"00",minutes:"00",seconds:"00",start:"start",stop:"stop",reset:"reset",divider:":",disable:!1,disabledClass:"timer-disabled",onClass:"timer-on",offClass:"timer-off",timerClass:"timer",hoursClass:"timer-hours",minutesClass:"timer-minutes",secondsClass:"timer-seconds",controlClass:"timer-control",startClass:"timer-start",stopClass:"timer-stop",resetClass:"timer-reset",switchControls:!1,buildTimer:!0,buildControl:!0,hideHours:!1,hideMinutes:!1,hideSeconds:!1,hideStart:!1,hideStop:!1,hideReset:!1},f=1,g={},h="data-timing-mode",i="data-timing-type",j="data-timing-set",k="data-timing-get",l="data-timing-target",m="data-timing-id",n={start:!0,stop:!0,reset:!0,hours:!0,minutes:!0,seconds:!0};buildWrapper=function(b,c,d){var e=a("["+m+'="'+b+'"]'),f=e.find("["+h+'="'+c+'"]');return f.length||(e.append("<div "+h+'="'+c+'" class="'+d+'"></div>'),f=e.find("["+h+'="'+c+'"]')),f},buildInner=function(b,c,d,e,f,g,h){var j=c.find("["+i+'="'+d+'"]');j.length?("undefined"==typeof j.attr(l)&&j.attr(l,b),j.text(f)):(j=a("<span "+i+'="'+d+'" '+l+'="'+b+'" class="'+e+'">'+f+"</span>"),c.append(j),h!==!1&&c.append(h)),g===!0&&j.hide()},buildTiming=function(a,b){if(b.buildTimer===!0){var c=buildWrapper(a,"timer",b.timerClass);buildInner(a,c,"hours",b.hoursClass,b.hours,b.hideHours,b.divider),buildInner(a,c,"minutes",b.minutesClass,b.minutes,b.hideMinutes,b.divider),buildInner(a,c,"seconds",b.secondsClass,b.seconds,b.hideSeconds,!1)}if(b.buildControl===!0){var d=buildWrapper(a,"control",b.controlClass);buildInner(a,d,"start",b.startClass,b.start,b.hideStart,!1),buildInner(a,d,"stop",b.stopClass,b.stop,b.hideStop,!1),buildInner(a,d,"reset",b.resetClass,b.reset,b.hideReset,!1)}},timingTimer=function(a,b,c,d){g[a].hours=parseFloat(g[a].hours),g[a].minutes=parseFloat(g[a].minutes),g[a].seconds=parseFloat(g[a].seconds),g[a].seconds++,g[a].seconds>59&&(g[a].seconds=0,g[a].minutes=g[a].minutes+1),g[a].minutes>59&&(g[a].minutes=0,g[a].hours=g[a].hours+1),timingTimerSet(b,"0".substring(g[a].hours>=10)+g[a].hours),timingTimerSet(c,"0".substring(g[a].minutes>=10)+g[a].minutes),timingTimerSet(d,"0".substring(g[a].seconds>=10)+g[a].seconds)},timingGetId=function(a){var b={};return"object"==typeof a?"undefined"!=typeof a.timingTarget?b[a.timingTarget]=a.timingTarget:"undefined"!=typeof a.timingId?b[a.timingId]=a.timingId:b=a:b[a]=a,b},timingGetType=function(a,b){var c=a.find("["+i+'="'+b+'"]');return c.length?c:!1},timingGetTimer=function(b){var c=a("["+m+'="'+b+'"]'),d={target:c,hours:timingGetType(c,"hours"),minutes:timingGetType(c,"minutes"),seconds:timingGetType(c,"seconds")};return d},timingTimerSet=function(a,b){a!==!1&&a.html(b)},timingChangeState=function(b,c,d,e){a.each(timingGetId(d),function(d,f){if(f in g){var h=a("["+m+'="'+f+'"]');"disable"===b&&(g[f].disable=!0,h.addClass(e)),"enable"===b&&(g[f].disable=!1,h.removeClass(e)),c.trigger("timing."+b,g[f])}})},timingSwitchControl=function(b,c,d,e){if(c===!0){var f=a("["+l+'="'+b+'"]['+i+'="'+d+'"]'),g=a("["+l+'="'+b+'"]['+i+'="'+e+'"]');"none"!=f.css("display")&&f.hide(),"none"==g.css("display")&&g.show()}},timingTrigger=function(b,c,d,e){var f=n;f.enable=!0,f.disable=!0,d=f[d]===!0?'="'+d+'"':"",a("["+c+d+"]").on(e,function(){var c=a(this);c.timing(b,c.data())})},Plugin=function(b){this.options=a.extend({},e),this.selector=a(b),this.element=b},Plugin.prototype={init:function(b){a.extend(this.options,b);var c=this,d=1;this.selector.each(function(){var b=f+"-"+d,e=a(this),h=e.attr(m);"undefined"==typeof h?e.attr(m,b):b=h,b in g||(g[b]={timingId:b,timer:0,timing:!1,timerReset:!1,timeStart:0,timeEnd:0,disable:c.options.disable,hours:c.options.hours,minutes:c.options.minutes,seconds:c.options.seconds}),c.options.switchControls===!0&&(c.options.hideStop=!0),c.options.disable===!0&&e.addClass(c.options.disabledClass),buildTiming(b,c.options),d++}),f++},start:function(b){var c=this;a.each(timingGetId(b),function(a,b){if(b in g&&g[b].timing!==!0&&g[b].disable!==!0){var d=timingGetTimer(b);d.target.length&&(d.target.removeClass(c.options.offClass),d.target.addClass(c.options.onClass)),g[b].timing=!0,g[b].timerReset=!1,g[b].timeStart=new Date,g[b].timer=setInterval(function(){timingTimer(b,d.hours,d.minutes,d.seconds)},1e3),timingSwitchControl(b,c.options.switchControls,"start","stop"),c.selector.trigger("timing.start",g[b])}})},stop:function(b){var c=this;a.each(timingGetId(b),function(b,d){if(d in g&&g[d].timing!==!1&&0!==g[d].timer&&g[d].disable!==!0){clearInterval(g[d].timer),g[d].timing=!1,g[d].timerReset=!0,g[d].timeEnd=new Date,g[d].timer=0;var e=a("["+m+'="'+d+'"]');e.length&&(e.removeClass(c.options.onClass),e.addClass(c.options.offClass)),timingSwitchControl(d,c.options.switchControls,"stop","start"),c.selector.trigger("timing.stop",g[d])}})},reset:function(b){var c=this;a.each(timingGetId(b),function(a,b){if(b in g&&g[b].timerReset!==!1&&g[b].disable!==!0){clearInterval(g[b].timer),g[b].timing=!1,g[b].timerReset=!1,g[b].timer=0,g[b].hours=c.options.hours,g[b].minutes=c.options.minutes,g[b].seconds=c.options.seconds;var d=timingGetTimer(b);d.target.length&&(d.target.removeClass(c.options.onClass).removeClass(c.options.offClass),timingTimerSet(d.hours,"00"),timingTimerSet(d.minutes,"00"),timingTimerSet(d.seconds,"00")),timingSwitchControl(b,c.options.switchControls,"stop","start"),c.selector.trigger("timing.reset",g[b])}})},disable:function(a){timingChangeState("disable",this.selector,a,this.options.disabledClass)},enable:function(a){timingChangeState("enable",this.selector,a,this.options.disabledClass)},getData:function(b,c,d){var e=this,f={};return a.each(timingGetId(b),function(h,i){"undefined"==typeof d&&"undefined"!=typeof b.timingGet&&(d=b.timingValue),"undefined"!=typeof b.timingGet&&(c=b.timingGet),i in g&&(f[i]="undefined"!=typeof c?g[i][c]:g[i],"undefined"!=typeof d&&a(d).html(f),e.selector.trigger("timing.getData",f))}),f},setData:function(b,c,d){var e=this;a.each(timingGetId(b),function(f,h){if("undefined"==typeof c&&"undefined"!=typeof b.timingSet&&(c=b.timingSet),"undefined"!=typeof b.timingValue&&(d=b.timingValue),h in g&&"undefined"!=typeof d&&n[c]===!0){var j=a("["+m+'="'+h+'"]');target=j.find("["+i+'="'+c+'"]'),target.length&&target.html(d),g[h][c]=d,e.selector.trigger("timing.setData",d)}})},destroy:function(){this.selector.trigger("timing.destroy",g),this.element.data(d,null)}},a.fn[c]=function(b){var e,f;if(this.data(d)instanceof Plugin||this.data(d,new Plugin(this)),f=this.data(d),null!==f)if(f.element=this,"undefined"==typeof b||"object"==typeof b)"function"==typeof f.init&&f.init(b);else{if("string"==typeof b&&"function"==typeof f[b])return e=Array.prototype.slice.call(arguments,1),f[b].apply(f,e);a.error("Method "+b+" does not exist on jQuery."+c)}},a("["+m+"]").each(function(){var b=a(this),c=b.attr(m);c in g||b.timing(b.data())}),a(b).on("load",function(){timingTrigger("start",i,"start","click"),timingTrigger("stop",i,"stop","click"),timingTrigger("reset",i,"reset","click"),timingTrigger("disable",i,"disable","click"),timingTrigger("enable",i,"enable","click"),timingTrigger("setData",j,!1,"click"),timingTrigger("getData",k,!1,"click")})}(jQuery,window,document);